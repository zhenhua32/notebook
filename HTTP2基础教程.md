# HTTP2基础教程 笔记

## 书籍信息

* 书名: HTTP/2基础教程
* 作者: Stephen Ludin  Javier Garza
* 出版社: 人民邮电出版社
* 来源: 多看

## 笔记

HTTP2 必然是未来的趋势, 早点了解很有必要. 可惜没看过 HTTP权威指南.
本书也很薄, 毕竟是单一主题.

如果不关心原理, 最重要的或许是快速起步部署.

HTTP2 在所有浏览器上的实现都是 TLS. 所以 https 是必要的.

作者使用的 https 工具是 Let's Encrypt, 配上工具 Certbot. 这也是我自己
部署时使用的工具. 这工具还是方便的, 毕竟不用自己改 web 服务器的配置文件.

作者使用的 web 服务器是 nghttp2. 

## 优化

作者讨论了 HTTP1 和 HTTP2 之间的优化方式的差异. 有些 HTTP1 的优化已经
不是 HTTP2 了, 反而可能会带来性能问题.

web 性能指标

* 延迟
* 带宽
* DNS 查询
* 建立连接时间
* TLS 协商时间
* 首字节时间 TTFB
* 内容下载时间
* 开始渲染时间
* 文档加载完成时间 或 页面加载时间

HTTP1 的问题

* 队头阻塞
* 低效的 TCP 利用, 主要是拥塞窗口
* 臃肿的消息首部
* 受限的优先级设置
* 第三方资源

web 性能的最佳实践

* DNS 查询优化
    * 限制不同域名的数量
    * 保证低限度的解析延迟
    * 使用 DNS 预取指令
* 优化 TCP 连接
    * 利用 preconnect 指令
    * 尽早终止并响应, 使用 CDN
    * 实施最新的 [TLS 最佳实践](https://istlsfastyet.com)
* 避免重定向
* 客户端缓存
* 网络边缘的缓存
* 条件缓存
    * 使用 Last-Modified0Since 头部
    * 使用 ETag
* 压缩和代码极简化
* 避免阻塞 CSS 和 JS
* 图片优化

HTTP2 下的反模式

* 生成精灵图和资源合并/内联
* 域名拆分
* 禁用 cookie 的域名

## 协议与原理

HTTP2 大致可分为两部分, 分帧层和数据层.

* h2 的分帧层是基于帧的二进制协议.
* 首部压缩
* 多路复用
* 加密传输, 基于 https
* 服务端推送

帧结构之类的就不描述了


## 调试工具

chrome://net-internals

webpagetest

openssl







